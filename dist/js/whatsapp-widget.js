!function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e,a,n={exports:{}};const s=t((e||(e=1,a=n,function(t){if("function"!=typeof e){var e=function(t){return t};e.nonNative=!0}const n=e("plaintext"),s=e("html"),r=e("comment"),i=/<(\w*)>/g,c=/<\/?([^\s\/>]+)/;function o(t,e,a){return h(t=t||"",l(e=e||[],a=a||""))}function l(t,a){return{allowable_tags:t=function(t){let a=new Set;if("string"==typeof t){let e;for(;e=i.exec(t);)a.add(e[1])}else e.nonNative||"function"!=typeof t[e.iterator]?"function"==typeof t.forEach&&t.forEach(a.add,a):a=new Set(t);return a}(t),tag_replacement:a,state:n,tag_buffer:"",depth:0,in_quote_char:""}}function h(t,e){if("string"!=typeof t)throw new TypeError("'html' parameter must be a string");let a=e.allowable_tags,i=e.tag_replacement,c=e.state,o=e.tag_buffer,l=e.depth,h=e.in_quote_char,d="";for(let u=0,w=t.length;u<w;u++){let e=t[u];if(c===n)"<"===e?(c=s,o+=e):d+=e;else if(c===s)switch(e){case"<":if(h)break;l++;break;case">":if(h)break;if(l){l--;break}h="",c=n,o+=">",a.has(p(o))?d+=o:d+=i,o="";break;case'"':case"'":h=e===h?"":h||e,o+=e;break;case"-":"<!-"===o&&(c=r),o+=e;break;case" ":case"\n":if("<"===o){c=n,d+="< ",o="";break}o+=e;break;default:o+=e}else c===r&&(">"===e?("--"==o.slice(-2)&&(c=n),o=""):o+=e)}return e.state=c,e.tag_buffer=o,e.depth=l,e.in_quote_char=h,d}function p(t){let e=c.exec(t);return e?e[1].toLowerCase():null}o.init_streaming_mode=function(t,e){let a=l(t=t||[],e=e||"");return function(t){return h(t||"",a)}},a.exports?a.exports=o:t.striptags=o}(n.exports)),n.exports));class r{constructor(t){this.cta=t.cta,this.hours=t.hours,this.message=t.message,this.name=t.name,this.phone=t.phone,this.schedule=t.schedule}get isEnabled(){const t=new Date,e=t.getDay();if(!this?.schedule?.length)return!0;const a=this.schedule[e];if(!a||a.length<2)return!1;const[n,s]=[a[0].split(":"),a[1].split(":")],[r,i]=[new Date(t.getFullYear(),t.getMonth(),t.getDate()<10?0+t.getDate():t.getDate(),+n[0],+n[1]),new Date(t.getFullYear(),t.getMonth(),t.getDate()<10?0+t.getDate():t.getDate(),+s[0],+s[1])];return t.getTime()>=r.getTime()&&t.getTime()<=i.getTime()}render(){return document.createRange().createContextualFragment(`<a href="#" data-phone="${s(this.phone)}" data-title="${s(this.name)}" data-message="${s(this.message)}" class="wa-w_a_a js-owaa" title="${s(this.name)} ${s(this.phone)}">\n\t\t\t<span class="wa-w_a_a_i"><span class="wa-w-i wa-w-i-cc"></span></span>\n\t\t\t<span class="wa-w_a_a_c">\n\t\t\t\t<span class="a_t">${s(this.name)}</span>\n\t\t\t\t<span class="a_s">${s(this.hours)}</span>\n\t\t\t\t<span class="a_c">${s(this.cta)}<span class="a_c_i wa-w-i wa-w-i-e"></span></span>\n\t\t\t</span>\n\t\t</a>`)}}window.whatsapp=class{constructor(t){this.package="{{package}}",this.url="{{url}}",this.agents=t.agents||[],this.description=t.description||"Chatea con nosotros por Whatsapp",this.title=t.title||"Â¿Necesitas ayuda?",this.agents.length&&this.#t()&&this.#e(`${this.url}/dist/css/${this.package}.css`).then(()=>{this.render()})}get widget(){return this.$widget}set widget(t){this.$widget=t}#t(){let t=0;return this.agents.forEach(e=>{new r(e).isEnabled&&t++}),t}#a(){const t=document.createElement("section");return t.classList.add("wa-w_a"),this.agents.forEach(e=>{const a=new r(e);a.isEnabled&&t.append(a.render())}),t}#n(){return document.createRange().createContextualFragment(`<button class="wa-w_b" title="${s(this.title)}">\n\t\t\t<span class="wa-w-i wa-w-i-w"></span>\n\t\t</button>`)}#s(){window.dataLayer&&window.dataLayer.push({event:"ga_event",category:"Widget WhatsApp",action:"Click WhatsApp",label:"Click Icono"}),this.widget.classList.toggle("open")}#r({message:t="",phone:e="",title:a=""}){window.dataLayer&&window.dataLayer.push({event:"ga_event",category:"Widget WhatsApp",action:"Click WhatsApp",label:a||"Unknown"});const n=t?`?text=${s(t)}`:"";window.open(`https://wa.me/${e?.replace(/ /g,"").replace("+","")}${s(n)}`,"_blank")}#i(){return document.createRange().createContextualFragment(`<header class="wa-w_h">\n\t\t\t<span class="wa-w_h_t">${s(this.title)}</span>\n\t\t\t<span class="wa-w_h_s">\n\t\t\t\t<span class="wa-w_h_i wa-w-i wa-w-i-w"></span>\n\t\t\t\t${s(this.description)}\n\t\t\t</span>\n\t\t</header>`)}#e(t){return new Promise((e,a)=>{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",t),n.onload=()=>{e()},n.onerror=()=>{console.error(`Error loading stylesheet: ${t}`),a(new Error(`Error loading stylesheet: ${t}`))},document.head.appendChild(n)})}async render(){const t=document.createElement("div");t.classList.add("wa-w"),t.append(this.#i()),t.append(this.#a()),t.append(this.#n()),document.body.append(t),t.querySelector(".wa-w_b")?.addEventListener("click",()=>{this.#s()});const e=t.querySelectorAll(".js-owaa");return e&&e.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const{message:a,phone:n,title:s}=t.dataset;this.#r({message:a,phone:n,title:s})})}),this.widget=t}}}();
